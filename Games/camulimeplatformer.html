<html><head>
    <script language="javascript" type="text/javascript" 
  src="Header.txt"></script>
<center><button onclick="localStorage.clear()">Reset High Score</button>
<h3 style="color:red;">This game is in a development stage</h3></center>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.24.1/dist/phaser-arcade-physics.min.js"></script>

<script>
const config = {
  type: Phaser.WEBGL,
  width: 500,
  height: 500,
  backgroundColor: 0x7777FF,
	scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH,
    },
  parent: "game-container",
  physics: {
    default: 'arcade',
    arcade: {
      debug: true, //eval(window.prompt("debug?")) 
      //gravity: {y:650}
    }
  },
	audio: {
        disableWebAudio: true
    },
  scene: {
    preload: preload,
    create: create,
    update: update,
		render: render
  }
}
const game = new Phaser.Game(config);
var title = true
var hsv = Phaser.Display.Color.HSVColorWheel();
var q = 0
var score = 0
var inc = 0
var warp = 0
//HighScore initiation ----------
const SAVEKEY = "highscore"
var scoreHigh = localStorage.getItem(SAVEKEY)
var scoreSTR = localStorage.getItem(SAVEKEY)
if (scoreSTR == null)scoreHigh = 0
else scoreHigh = parseInt(scoreSTR)
//load assets ----------
function preload() {
  this.load.spritesheet('camul', 'https://i.imgur.com/tmyUnnq.png', { frameWidth: 42.66666666666666666666667, frameHeight: 42.625});
	 this.load.image('platform', 'https://i.imgur.com/VaUmAd3.png');
	 this.load.image("button", 'https://i.imgur.com/dkt9AeI.png')
	 this.load.image('tick','https://i.imgur.com/oAPJ5A2.png')
	 this.load.image("lime", 'https://i.imgur.com/GjmByPc.png')
	 this.load.image("barrier",'https://i.imgur.com/69npiyO.png')
	 //audio ----------------
	 this.load.audio("bgsound",'https://camelpilot33.github.io/Camul-Home-Page/Audio/CamulMusic.mp3')
	 this.load.audio("collect",'https://camelpilot33.github.io/Camul-Home-Page/Audio/coin.wav')
	 this.load.audio("jump",'https://camelpilot33.github.io/Camul-Home-Page/Audio/Jump.wav')
	 this.load.audio("footstep",'https://camelpilot33.github.io/Camul-Home-Page/Audio/footstep.wav')
	 this.load.audio("thump",'https://camelpilot33.github.io/Camul-Home-Page/Audio/sound.wav')
}
function create() {
		W = this.input.keyboard.addKey('W');
	  S = this.input.keyboard.addKey('S');
 		A = this.input.keyboard.addKey('A');
 		D = this.input.keyboard.addKey('D');
		//AUDIO ------------------------
	 music = this.sound.add('bgsound',{
    mute: false,
    volume: 0.5,
    loop: true,
    delay: 0
}).play();
	 collect = this.sound.add('collect')
	 jump = this.sound.add('jump')
	 thump = this.sound.add("thump")
	 //CREATE-----------------------
  this.anims.create({
 		key: 'left',
 		frames: this.anims.generateFrameNumbers('camul', { start: 12, end: 14 }),
 		frameRate: 10,
		repeat: -1
	});
  window.camul = this.physics.add.sprite(0, 100, 'camul').setInteractive().play('left').setGravityY(500)
	tick = this.physics.add.sprite(-400,0,'tick')
	//scoring
	scoretxt = this.add.text(0, 0, 'Score: '+score, { font: "20px Arial Black", fill: "#FFFFFF" }).setScrollFactor(0.0).setTint(0xFFd700)
	scoreHightxt = this.add.text(0, 30, 'Best: '+scoreHigh, { font: "20px Arial Black", fill: "#FFFFFF" }).setScrollFactor(0.0);
	this.physics.add.collider(camul,tick,function(){camul.disableBody(true,true)})
	plats = this.physics.add.staticGroup()
	function plat(x,y) {
		plats.create(x, y,"platform").setScale(0.2).refreshBody().setSize(150, 20)
	}
	//riddles ---------------------
	riddles = [
		[["You have a farm of horses and chickens. There are 52 feet and 21 heads. How many horses do you have? (integer)"],["5"]],
		[["37, 34, 31, 28, __? (integer)"],["25"]],
		[["3 of the following add up to 27: 5, 6, 13, 16 (true/false)"],["true"]]
	]
	function riddle(){
		let rand = Math.floor(Math.random()*riddles.length)
		if (window.prompt(riddles[rand][0]) == riddles[rand][1]) {
			lime1.disableBody(true,true)
			bar1.disableBody(true,true)
			score += 40
			collect.play()
		}
		else {
			window.camul.disableBody(true,true)
		}
	}
	//world -----------------------
	plat(0,200)
	plat(150,100)
	plat(0,0)
	plat(250,-100)
	plat(500, -100)
	plat(650, -100)
	bar1 = plats.create(600, -200, 'barrier').setScale(10).refreshBody()
	lime1 = this.physics.add.sprite(500, -200,'lime').setScale(3)
	this.physics.add.overlap(lime1,window.camul,riddle)
	plat(800, -100)
	this.physics.add.collider(window.camul,plats)
	this.cameras.main.startFollow(window.camul)
	this.cameras.main.setZoom(1)  
	//title -----------------------
	ts = this.add.rectangle(0, 100, 600,700,0x055555)//.setScale(2000).setTint(0x445566)
	tstxt = this.add.text(-230, 0, 'CamuLime Platformer', {
    fontSize: '40px',
    fill: '#FFFFFF'
  })
  Button = this.physics.add.image(0, 200, 'button').setScale(0.5).setInteractive()
  Button.on('pointerover', function() {
    Button.setTint(0x555555);
  }, this)
  Button.on('pointerout', function() {
    Button.setTint(0xffffff);
  }, this)
  Button.on('pointerdown', function() {
    ts.setAlpha(0)
    tstxt.destroy();
    Button.destroy();
    title = false
  })

}
function update(){
//audio spatialization
let distanceThreshold = 500; //This is the max distance from the object. Any farther and no sound is played.
let distanceToObject = Phaser.Math.Distance.Between(window.camul.x, window.camul.y, tick.x, tick.y);
let normalizedSound = 1 - (distanceToObject / distanceThreshold);
thump.setVolume(normalizedSound)//normalizedSound;
if (inc%30 == 4) thump.play()
//title
	if (title == true){
	var tint = hsv[q]
  q++;
  if (q === hsv.length) {
    q = 0;
  }
  tstxt.setTint(tint.color);
	window.camul.setVelocityY(-8.333333333333333215)
	window.camul.y=100
	}
		if(title != true){
		inc += 1
		
		//highScore
		if (score > scoreHigh) {
			scoreHigh = score
			localStorage.setItem(SAVEKEY,scoreHigh)
		}
		//text update -------------------------
		scoretxt.setText("Score: "+score)
		scoreHightxt.setText("HI: "+scoreHigh)
    const chroma = hsv[359 - warp].color;
		scoreHightxt.setTint(chroma)
		if (score == scoreHigh){scoretxt.setTint(chroma);}
		warp++
    if (warp == hsv.length)
    {
        warp = 0;
    }
		//movement ----------------------------
		if ((window.camul.body.velocity.x>1 || window.camul.body.velocity.x<-1) && window.camul.body.onFloor() && inc%15 == 4) {
        this.sound.play('footstep');
    }
		let angle = Phaser.Math.Angle.Between(tick.x, tick.y, window.camul.x, window.camul.y);
    tick.setRotation(angle+1.5)
		this.physics.moveToObject(tick,window.camul,20)
    if (D.isDown) {
      window.camul.flipX = true
      window.camul.anims.resume()
			window.camul.setVelocityX(200)
    }
		if (A.isDown) {
      window.camul.flipX = false
      window.camul.anims.resume()
			window.camul.setVelocityX(-200)
    }
    if (!(window.camul.body.touching.down)) window.camul.anims.pause(window.camul.anims.currentAnim.frames[1])
    if (W.isDown && window.camul.body.touching.down) {window.camul.body.setVelocityY(-350);jump.play()}
    if (!(A.isDown || D.isDown)) {
    	window.camul.body.setVelocityX(0)
      window.camul.anims.pause(window.camul.anims.currentAnim.frames[1])
    } else {window.camul.anims.resume()}
		
	}
	//detect death
	if(window.camul.body.velocity.y > 1000) window.camul.disableBody(true,true)
}
function render() {}
</script>
</body></html>
